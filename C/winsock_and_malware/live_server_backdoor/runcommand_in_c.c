#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <direct.h>
#include <winbase.h>

char* full_path;

char* execute_command(char* command)
{
    FILE *fp;
    char path[100];
    char* pathh = (char*)malloc(2048);
    fp = popen(command, "r");
    if (fp == NULL) {
        printf("Failed to run command\n" );
        exit(1);
    }
    /* Read the output a line at a time - output it. */
    while (fgets(path, sizeof(path), fp) != NULL) {
        // printf("%s",path);
        // strcat(pathh,"\n");
        strcat(pathh,path);
        
    } 
    // printf(pathh);
    pclose(fp);
    return pathh;
}


char* r_path(char* command){
    if (strncmp(command, "cd ",3) != 0){
        return command;
    }
    char* token = command + 3;
    // printf(" %s ", token);
    return token;
} 

char *construct_cd_command(char* full_path,char* command){
    char* cmd = (char*)malloc(2048);
    cmd[0] = 'c';
    cmd[1] = 'd';
    cmd[2] = ' '; 
    for (int j = 0; j < strlen(full_path); j++){
        //printf("%c ", full_path[j]);
        cmd[j + 3] = full_path[j];
    }
    cmd[strlen(full_path)+3] = ' ';
    cmd[strlen(full_path)+4] = '&';
    cmd[strlen(full_path)+5] = '&';
    cmd[strlen(full_path)+6] = ' ';
    for (int j = 0; j < strlen(command) + 1; j++){
        //printf("%c ", command[j]);
        cmd[strlen(full_path) + 7 + j] = command[j];
    }
    return cmd;
}

char* wrap_text(char* text){
    char* r_text = (char*)malloc(strlen(text)+4);
    r_text[0] = '"';
    for (int i=0;i<strlen(text);i++){
        r_text[i+1] = text[i];
    }
    r_text[strlen(text)+1] = '"';
    r_text[strlen(text)+2] = '\0' ;
    return r_text;
}

char* change(char* path){

}

char* execute_command_2(char* command)
{
    FILE *fp;
    char path[100];
    char* path_rt = (char*)malloc(2048);
    fp = popen(command, "r");
    if (fp == NULL) {
        printf("Failed to run command\n" );
        exit(1);
    }
    while (fgets(path, sizeof(path), fp) != NULL) {
        strcat(path_rt,path);
    } 
    pclose(fp);
    return path_rt;
}

char* cd_path(char* path){

    char *buffer = (char*)malloc(1024);
    if(_chdir(path)==-1){
        return "Path Failed";
    }
    _getcwd(buffer,1024);
    return buffer;
}

/*
int main(){
    char *buffer = (char*)malloc(1024);
    if (_getcwd(buffer,1024)==NULL){
        printf("Get current working directory failed. \n");
    }
    printf("\ndirectory: \n\n%s\n\n", buffer);
    printf("aftrcall = %s",cd_path(".."));
    
    if (_getcwd(buffer,1024)==NULL){
        printf("Get current working directory failed. \n");
    }
    printf("\ndirectory: \n\n%s\n\n", buffer);

}
*/

int main() {
    char temp[50];
   char string[50] = "cd ../..";
   // Extract the first token
   char * token = strtok(string, " ");
   // loop through the string to extract all other tokens
   while( token != NULL ) {
        strcpy(temp,token);
      printf( " %s\n", temp ); //printing each token
      if (strcmp(temp,"cd")==0) printf("\nhoan ho\n");
      token = strtok(NULL, " ");
   }
   return 0;
}

